Nmap - A Powerful Scanning Tool

Introduction

When we are given a target IP/s to perform a security audit on, the first step we must do is enumerate before attempting to exploit.
In order to get a map of the target, we perform a port scan, this will help us determine what services are running on the target, such as
a web server of a Windows Active Directory Domain Controller. Ports are a networking contruct that is necessary in order to make multiple
requests or have multiple services available. For example, when you load multiple pages at once in a browser, the program needs a way to
know which tab is which page. This is done by establishing connections with the remote servers using different ports of your local machine.
Equally, if you want to run different services on your server, like https and http version of the same site, you need a way to direct the
traffic. Again, this is done by running the services on different ports of the server.
Network connections are made between two ports, an open port listening on the server and a randomly selected port on your machine. Like
Port 443 of a web server and port 65235 on your computer.

Ports available: 65535 ports
Standard Ports
Port 80: http
Port 443: https
Port 139: Windows Netbios
Port 445: SMB

These standard ports could be changed in configuration, so it is imperative to perform an scan when enumerating the target.

If we don't know what ports are open on the target, it is almost imposible to succeed in exploiting it. This is how nmap can help us, it
connects to every port and based on how it responds it is determined whether the port is open, closed, or filtered (firewall). Then we
can enumerate the service running on the open ports, usually through nmap as well. Nmap is currently the industry standard tool due to its
functionallity and reliability, which include its scripting engine which sometimes even allows to perform exploits through it.

Nmap Switches

Switches are arguments that tell the program what to do. In order to see the switches for nmap consult the man page.
There are many different types of scans and script-scans that nmap can perform. This will depend on the situation at hand. Pick the one that
best suits your current setting.

Take good time to read the man page of nmap as it is well written and has lots of useful information.

Scan Types: Overview

When port scanning there are three basic scan types:

-sT: TCP connect scans
-sS: SYN "half-open" scans
-sU: UDP scans

Additionally there are several less common scan types:

-sN: null TCP scans
-sX: Xmax TCP scans
-sF: FIN Scans


TCP Connect Scans / -sT

The TCP connect scan uses the TCP three way handshake to work, that is, it used the SYN packet with every port on the target
and based on the response, it determines whether the port is open or not. If a port is closed, upon receiving our SYN request
it would reply with a RST (reset) flag and this ignoring the connection, if the port is open it would reply with a segment
containing the SYN/ACK flags, and nmap would complete the handshare by replying with the ACK flag, nmap would then mark this
port as open. 

If port is closed:
	Client		Target
	SYN ----------->
	   <-----------RST

If port is open:
	Client		Target
	SYN------------->
	  <-------------SYN/ACK
	ACk------------>

This is all correct but there is another scenario which is the Firewall. If nmap sends the TCP SYN request and get nothing
back this most likely means that the port is being walled by a firewall. This makes the port Filtered.

It is also possible to configure a firewall to respond with the TCP RST packet, making it extremely difficult to get a good
idea of the target. Here is an example of how to configure IPtables on Linux to respond with the RST flag:
	>>> iptables -I INPUT -p tcp --dport <port> -j REJECT --reject-with tcp-reset


